{"version":3,"sources":["Canvas.js","FileUpload.js","Box.js","App.js","reportWebVitals.js","index.js"],"names":["Canvas","file","img","position","setImgResized","imgResized","imgLoaded","setImgLoaded","useState","top","setTop","left","setLeft","width","setWidth","height","setHeight","imgWidth","setImgWidth","imgHeight","setImgHeight","ready","useRef","useEffect","current","src","complete","naturalHeight","winHeight","window","innerHeight","winWidth","innerWidth","windowRatio","imgRatio","setImgDims","tf","process","then","model","tensor","fromPixels","sliced","length","readyfied","resizeNearestNeighbor","div","reshape","array","predict","dataSync","rect","getBoundingClientRect","faceBoxLeft","faceBoxTop","faceBoxWidth","faceBoxHeight","className","ref","alt","onLoad","style","FileUpload","setFile","type","name","onChange","e","target","files","substr","reader","FileReader","onload","result","readAsDataURL","Box","box","setPosition","setLength","dragging","x","y","imgTop","imgLeft","imgBottom","imgRight","byWidth","bottom","right","isWithinLimitsWidth","newTop","newBottom","isWithinLimitsHeight","newLeft","newRight","onMouseDown","event","preventDefault","clientX","clientY","onMouseMove","posX","posY","onMouseUp","Math","floor","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.eca92597.chunk.js","sourcesContent":["import React, { useRef, useEffect, useState } from \"react\";\r\nimport * as tf from \"@tensorflow/tfjs\";\r\n\r\nconst MODEL_PATH = process.env.PUBLIC_URL + \"/model/model.json\";\r\nconst PROPORTION = 0.9;\r\n\r\nexport default function Canvas({\r\n  file,\r\n  img,\r\n  position,\r\n  imgResized,\r\n  setImgResized,\r\n  imgLoaded,\r\n  setImgLoaded,\r\n}) {\r\n  const [top, setTop] = useState(null);\r\n  const [left, setLeft] = useState(null);\r\n  const [width, setWidth] = useState(null);\r\n  const [height, setHeight] = useState(null);\r\n  const [imgWidth, setImgWidth] = useState(null);\r\n  const [imgHeight, setImgHeight] = useState(null);\r\n  const ready = useRef(null);\r\n\r\n  const setImgDims = () => {\r\n    const winHeight = PROPORTION * window.innerHeight;\r\n    const winWidth = PROPORTION * window.innerWidth;\r\n    const windowRatio = winHeight / winWidth;\r\n    const imgRatio = img.current.height / img.current.width;\r\n    if (imgRatio > windowRatio) {\r\n      setImgHeight(winHeight);\r\n      setImgWidth(winHeight / imgRatio);\r\n    } else {\r\n      setImgWidth(winWidth);\r\n      setImgHeight(winWidth * imgRatio);\r\n    }\r\n    ready.current = true;\r\n    setImgResized(true);\r\n  };\r\n\r\n  const onLoad = () => {\r\n    ready.current = false;\r\n    setImgResized(false);\r\n    setImgLoaded(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!file) return;\r\n    img.current.src = file;\r\n  }, [file]);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      ready.current ||\r\n      !img.current ||\r\n      !img.current.complete ||\r\n      img.current.naturalHeight === 0\r\n    )\r\n      return;\r\n    setImgDims();\r\n  }, [imgLoaded]);\r\n\r\n  useEffect(() => {\r\n    if (!position || !ready.current) return;\r\n    tf.tidy(() => {\r\n      tf.loadLayersModel(MODEL_PATH).then((model) => {\r\n        const tensor = tf.browser.fromPixels(img.current);\r\n        const sliced = tf.slice(\r\n          tensor,\r\n          [position.top, position.left],\r\n          [position.length, position.length]\r\n        );\r\n        const readyfied = tf.image\r\n          .resizeNearestNeighbor(sliced, [256, 256], true)\r\n          .div(255)\r\n          .reshape([1, 256, 256, 3]);\r\n        const result = model.predict(readyfied);\r\n        const array = result.dataSync();\r\n        const rect = img.current.getBoundingClientRect();\r\n        const faceBoxLeft =\r\n          rect.left + position.left + array[0] * position.length;\r\n        const faceBoxTop = rect.top + position.top + array[1] * position.length;\r\n        const faceBoxWidth = (array[2] - array[0]) * position.length;\r\n        const faceBoxHeight = (array[3] - array[1]) * position.length;\r\n        setTop(faceBoxTop);\r\n        setLeft(faceBoxLeft);\r\n        setHeight(faceBoxHeight);\r\n        setWidth(faceBoxWidth);\r\n      });\r\n    });\r\n  }, [position]);\r\n\r\n  if (!file) return null;\r\n\r\n  return (\r\n    <>\r\n      <img\r\n        className=\"img\"\r\n        ref={img}\r\n        src=\"\"\r\n        alt=\"pet\"\r\n        onLoad={onLoad}\r\n        style={{ width: imgWidth, height: imgHeight }}\r\n      />\r\n      <div\r\n        className=\"faceBox\"\r\n        style={{ top: top, left: left, width: width, height: height }}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nexport default function FileUpload({ setFile, setImgLoaded }) {\r\n  const readFile = (e) => {\r\n    setImgLoaded(false);\r\n    const file = e.target.files[0];\r\n    if (file && file.type.substr(0, 5) === \"image\") {\r\n      const reader = new FileReader();\r\n      reader.onload = function (e) {\r\n        setFile(reader.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <input className=\"inputFile\" type=\"file\" name=\"file\" onChange={readFile} />\r\n  );\r\n}\r\n","import React, { useEffect, useState, useRef } from \"react\";\r\n\r\nexport default function Box({ img, box, position, setPosition, imgResized }) {\r\n  const [top, setTop] = useState();\r\n  const [left, setLeft] = useState();\r\n  const [length, setLength] = useState();\r\n  const dragging = useRef(false);\r\n  const x = useRef();\r\n  const y = useRef();\r\n  const imgWidth = useRef();\r\n  const imgHeight = useRef();\r\n  const imgTop = useRef();\r\n  const imgLeft = useRef();\r\n  const imgBottom = useRef();\r\n  const imgRight = useRef();\r\n  const byWidth = useRef();\r\n\r\n  useEffect(() => {\r\n    if (!img.current) return;\r\n    const rect = img.current.getBoundingClientRect();\r\n    imgTop.current = rect.top;\r\n    imgLeft.current = rect.left;\r\n    imgBottom.current = rect.bottom;\r\n    imgRight.current = rect.right;\r\n    imgWidth.current = img.current.width;\r\n    imgHeight.current = img.current.height;\r\n    if (imgWidth.current > imgHeight.current) {\r\n      setLength(imgHeight.current);\r\n      byWidth.current = false;\r\n    } else {\r\n      setLength(imgWidth.current);\r\n      byWidth.current = true;\r\n    }\r\n    setTop(imgTop.current);\r\n    setLeft(imgLeft.current);\r\n  }, [imgResized]);\r\n\r\n  const onMouseDown = (e) => {\r\n    e = e || window.event;\r\n    e.preventDefault();\r\n    dragging.current = true;\r\n    x.current = e.clientX;\r\n    y.current = e.clientY;\r\n  };\r\n\r\n  const onMouseMove = (e) => {\r\n    if (dragging.current) {\r\n      e = e || window.event;\r\n      e.preventDefault();\r\n      const posX = x.current - e.clientX;\r\n      const posY = y.current - e.clientY;\r\n      x.current = e.clientX;\r\n      y.current = e.clientY;\r\n      if (byWidth.current) {\r\n        const newTop = top - posY;\r\n        if (isWithinLimitsWidth(newTop)) {\r\n          setTop(newTop);\r\n        }\r\n      } else {\r\n        const newLeft = left - posX;\r\n        if (isWithinLimitsHeight(newLeft)) {\r\n          setLeft(newLeft);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const isWithinLimitsWidth = (newTop) => {\r\n    const newBottom = newTop + length;\r\n    if (newTop < imgTop.current || newBottom > imgBottom.current) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  };\r\n\r\n  const isWithinLimitsHeight = (newLeft) => {\r\n    const newRight = newLeft + length;\r\n    if (newLeft < imgLeft.current || newRight > imgRight.current) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  };\r\n\r\n  const onMouseUp = (e) => {\r\n    dragging.current = false;\r\n    setPosition({\r\n      top: Math.floor(top - imgTop.current),\r\n      left: Math.floor(left - imgLeft.current),\r\n      length: Math.floor(length),\r\n    });\r\n  };\r\n\r\n  if (!img.current) return null;\r\n  return (\r\n    <div\r\n      ref={box}\r\n      className=\"box\"\r\n      onMouseDown={onMouseDown}\r\n      onMouseMove={onMouseMove}\r\n      onMouseUp={onMouseUp}\r\n      style={{ width: length, height: length, top: top, left: left }}\r\n    />\r\n  );\r\n}\r\n","import \"./App.css\";\nimport React, { useState, useRef } from \"react\";\nimport Canvas from \"./Canvas\";\nimport FileUpload from \"./FileUpload\";\nimport Box from \"./Box\";\n\nexport default function App() {\n  const [file, setFile] = useState(null);\n  const [position, setPosition] = useState(null);\n  const [imgLoaded, setImgLoaded] = useState(null);\n  const [imgResized, setImgResized] = useState(null);\n  const box = useRef(null);\n  const img = useRef(null);\n\n  return (\n    <>\n      <FileUpload setFile={setFile} setImgLoaded={setImgLoaded} />\n      <Box\n        img={img}\n        box={box}\n        position={position}\n        setPosition={setPosition}\n        imgResized={imgResized}\n      />\n      <Canvas\n        file={file}\n        img={img}\n        position={position}\n        imgResized={imgResized}\n        setImgResized={setImgResized}\n        imgLoaded={imgLoaded}\n        setImgLoaded={setImgLoaded}\n      />\n    </>\n  );\n}\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}